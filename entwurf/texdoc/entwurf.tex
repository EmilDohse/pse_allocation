%%This is a very basic article template.
%%There is just one section and two subsections.
\documentclass[parskip=full]{scrartcl}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{studarbeit}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{epstopdf}
\usepackage[binary-units=true]{siunitx}
 \usepackage[autostyle=true,german=quotes]{csquotes}
 \usepackage{longtable}

% ---------------------------------------------------------------------------
% TexDoc macros start - everything below this point should be copied to your
% own document and adapted to your style/language if needed
% ---------------------------------------------------------------------------

% Environment used to simulate html <p> </p>
\newenvironment{texdocp}{}{

}
% Environment for packages
\newenvironment{texdocpackage}[1]{%
	\newpage{}\gdef\packagename{#1}\subsection{Packet \texttt{#1}}
	\rule{\hsize}{.7mm}
}{}

% Environment for classes, interfaces
% Argument 1: "class" or "interface"
% Argument 2: the name of the class/interface
\newenvironment{texdocclass}[2]{%
	\gdef\classname{#2}
	\subsubsection{\texttt{#1 \textbf{#2}}}
}{\newpage{}}

% Environment for class description
\newenvironment{texdocclassintro}{
	\paragraph*{Beschreibung}
}{
}

% Environment around class fields
\newenvironment{texdocclassfields}{%
	\paragraph*{Attribute}
	\begin{itemize}
}{%
	\end{itemize}
}

% Environment around class methods
\newenvironment{texdocclassmethods}{%
	\paragraph*{Methoden}
	\begin{itemize}[itemsep=10pt]
}{%
	\end{itemize}
}

% Environment around class Constructors
\newenvironment{texdocclassconstructors}{%
	\paragraph*{Konstruktoren}
	\begin{itemize}
}{%
	\end{itemize}
}

% Environment around enum constants
\newenvironment{texdocenums}{%
	\paragraph*{Enum Konstanten}
	\begin{itemize}
}{%
	\end{itemize}
}

% Environment around "See also"-Blocks (\texdocsee invocations)
%  Argument 1: Text preceding the references
\newenvironment{texdocsees}[1]{
	
	\textbf{#1:}
	\begin{itemize}
}{%
	\end{itemize}
}
% Formats a single field
%  Argument 1: modifiers
%  Argument 2: type
%  Argument 3: name
%  Argument 4: Documentation text
\newcommand{\texdocfield}[4]{\item \texttt{#1 #2 \textbf{#3}} \\ #4}

% Formats an enum element
%  Argument 1: name
%  Argument 2: documentation text
\newcommand{\texdocenum}[2]{\item \texttt{\textbf{#1}} \\ #2}

% Formats a single method
%  Argument 1: modifiers
%  Argument 2: return type
%  Argument 3: name
%  Argument 4: part after name (parameters)
%  Argument 5: Documentation text
%  Argument 6: Documentation of parameters/exceptions/return values
\newcommand{\texdocmethod}[6]{\item \texttt{#1 #2 \textbf{#3}#4} \\ #5#6}

% Formats a single constructor
%  Argument 1: modifiers
%  Argument 2: name
%  Argument 3: part after name (parameters)
%  Argument 4: Documentation text
%  Argument 5: Documentation of parameters/exceptions/return values
\newcommand{\texdocconstructor}[5]{\item \texttt{#1 \textbf{#2}#3} \\ #4#5}

% Inserted when @inheritdoc is used
%  Argument 1: Class where the documentation was inherited from
%  Argument 2: Documentation
\newcommand{\texdocinheritdoc}[2]{#2 (\textit{Dokumentation geerbt von \texttt{#1})}}

% Formats a single see-BlockTag
%  Argument 1: text
%  Argument 2: reference label
\newcommand{\texdocsee}[2]{\item \texttt{#1 (\ref{#2})}}

% Environment around \texdocparameter invocations
\newenvironment{texdocparameters}{%
	%\minisec{Parameter}
	\paraRetText{Parameter}
	\begin{tabular}{ll}
}{%
	\end{tabular}
}

% Environment around \texdocthrow invocations
\newenvironment{texdocthrows}{%
        \minisec{Wirft}
        \begin{tabular}{ll}
}{%
        \end{tabular}
}

\newcommand{\texdocreturn}[1]{\paraRetText{Rückgabe} #1}

% Formats a parameter (this gets put inside the input of a \texdocmethod or 
% \texdocconstructor macro)
%  Argument 1: name
%  Argument 2: description text
\newcommand{\texdocparameter}[2]{\texttt{\textbf{#1}} & \begin{minipage}[t]{0.8\textwidth}#2\end{minipage} \\}

% Formats a throws tag
%  Argument 1: exception name
%  Argument 2: description text
\newcommand{\texdocthrow}[2]{\texttt{\textbf{#1}} & \begin{minipage}[t]{0.6\textwidth}#2\end{minipage} \\}

% Used to simulate html <br/>
\newcommand{\texdocbr}{\mbox{}\newline{}}

% Used to simulate html <h[1-9]> - </h[1-9]>
% Argument 1: number of heading (5 for a <h5>)
% Argument 2: heading text
\newcommand{\headref}[2]{\minisec{#2}}

\newcommand{\refdefined}[1]{
\expandafter\ifx\csname r@#1\endcsname\relax
\relax\else
{$($ in \ref{#1}, page \pageref{#1}$)$}
\fi}

\newcommand{\paraRetText}[1]{\\\textbf{#1}\\}
\setlist[itemize]{leftmargin =*, noitemsep}
\setlength{\parskip}{0.8em}
% ---------------------------------------------------------------------------
% TexDoc macros end
% ---------------------------------------------------------------------------


\begin{document}

\title{Elipse -- Einteilungs Interface für das PSE}
\author{D. Biester, E. Dohse, P. Faller, P. Loth, L. Seufert, S. Kopmann}
\thesistype{Entwurfsdokument}
\zweitgutachter{}
\betreuer{Dipl.-Inform.~Andreas~Zwinkau, M.Sc.~Andreas~Fried}
\coverimage{ElipseLogo.png}

\mytitlepage

\tableofcontents
\pagebreak

\section{Einleitung}
%TODO Einleitung mit anschluss an Pflichtenheft 
Als Architekturstil wird \enquote{Model-View-Controller} verwendet.
Die Pakete und verwendete Frameworks:
\begin{itemize}
  \item Model
  \begin{itemize}
   \item Data 
  \item ImportExport
  \item notificationSystem
  \item qualityCriteria
  \item security
  \item allocation (unter verwendung des ILP-Solvers Gurobi)
   \end{itemize}
   \item View
   \begin{itemize}
    \item Play-Framework
   \end{itemize}
   \item Controller
   \begin{itemize}
    \item Controller
   \end{itemize}
\end{itemize}
%TODO
\subsection{Änderungen zum Pflichtenheft}
Beim Entwurf haben wir uns für ein Paar Änderungen entschieden.
\begin{itemize}
  \item %TODO Student data edit page was genau ist das
  \item %TODO admin legt betreueraccouts an gui änderung
  \item %TODO betreuer kann sein passwort ändern
  \item %rest im änderungsdoc
\end{itemize}


\section{Dokumentation}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/controller.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/data.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/importExport.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/notificationSystem.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/qualityCriteria.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/security.tex}
\input{../org.eclipse.papyrus.javagen.RootElement/doc/allocation.tex}
\subsection{Routing}
\input{viewTable.tex}
\section{Sequenzdiagramme}
%TODO Sequenzdiagramm am ende einfügen

\section{ILP}
Zur berechnung einer Einteilung wird ein ILP verwendet. Hierbei ist das ILP
aufgeteilt in ein Basismodell und Einteilungskriterien. 

Für die Constraints werden im Weiteren für $\wedge$ (logisch AND) und
$\vee$ (logisch OR) die Folgenden Formeln verwendet:
\begin{align*}
\intertext{Für $y = x_1 \wedge x_2 \wedge \ldots \wedge x_n$:} 
\left(\sum_{k=1}^{N}x_k \right)-ny & \le n-1\\
ny - \sum_{k=1}^{N}x_k & \le 0\\
\intertext{Für  $y = x_1 \vee x_2 \vee \ldots \vee x_n$:}
ny - \sum_{k=1}^{N}x_k & \le n-1\\
\left(\sum_{k=1}^{N}x_k \right) - ny  &\le 0
\end{align*}
\subsection{Basismodell}
Das Basismodell besteht aus einer $N \times M$ Matrix $B$ binärer Variablen.
Hierbei ist $N$ die anzahl der Studierenden die die Pflichtvoraussetzungen für das PSE
erfüllt haben. $M$ ist die Anzahl der Teams plus einem Team
der nicht zugeteilten (welches sich in der Zeile $M$ befindet). Der
Matrixeintrag $B(k,j)$ ist 1 wenn der Student $k$ in Team $j$ ist und sonst 0.
Weiterhin gibt es Hilvsvariablen für häufig verwendetes: 
\begin{itemize}
  \item $x_j$ ist eine Hilfsvariable für die Teamgröße des Teams $j$. Sie berechnet
sich durch
\begin{equation*}
\sum_{k = 1}^{N} B(k,j) = x_j  \text{
als Constraint}
\end{equation*}
\end{itemize}


Außerdem werden im Basismodell die folgenden Basisconstraints definiert:



 \begin{itemize}
   \item Jeder Student ist in einem Team \begin{equation*}
   \sum_{j = 1}^{M} B(k,j) = 1 \text{ für } k \in \{ 1\ldots N \}
   \end{equation*}
   \item Die Teamgröße ist größergleich der vorgegebenen minimalen Teamgröße
   oder 0. Die Teamgröße ist kleinergleich der vorgegebenen maximalen Teamgröße
   Ausgenommen hiervon ist das Team der nicht zugeteilten. Hierzu wird eine
   Hilvsvariable $y_j$ pro Team $j$ verwendet. Die Constraints lauten:
   \begin{align*}
    0 &\le  y_j \le 1\\
     y_j &\le x_j\\ 
    x_j &\le maxSize_j \cdot y_j \\ 
    x_j &\ge minSize_j \cdot y_j 
    \end{align*}
    $\text{Somit ist } y_j = \begin{cases}
    1 \;\; \text{wenn $minSize_j \le x_j \le maxSize_j \vee x_j = 0$} \\
    0 \;\; \text{sonst} 
    \end{cases}$
 \end{itemize}
 
 Es gibt weiterhin einen Optimierungsterm der durch, in der für die Berechnung
 relevanten Konfiguration gegebenen Kriterien erweitert wird. Dieser wird leer
 initialisiert.


\subsection{Kriterien}
Die Kriterien dienen dazu, den im Basismodell enthaltenen Optimierungsterm zu
erweitern. Dabei werden die eingestellten Parameter $p_i$ ($i$ für das
jeweilige Kriterium) als Multiplikatoren für die Boni der Kriterien verwendet.
Diese Boni sind an der \enquote{++ Wertung} normiert. 

\subsubsection{CriterionAllocated}
Das Kriterium sorgt dafür das möglichst viele Studierende Teams zugeteilt
werden. Hierzu wird dem Optimierungsterm für jeden zugeltilten Student ein Bonus
von 10. Für nicht zugeteilte gibt es einen Bonus von 1. \begin{align*}
\intertext{Zum Optimierungsterm:}
p_i \cdot 10 \cdot \sum_{k = 1}^{N} \sum_{j = 1}^{M-1} B(k,j) \text{ für die
Zugeteilten}
\end{align*}

\subsubsection{CriterionRating}
Das Kriterium sorgt dafür das die Bewertungen der Studierenden berücksichtigt
werden. Für ein \enquote{++} gibt es einen Bonus von 10, für ein \enquote{+} 8,
für ein \enquote{o} 6, für ein \enquote{-} 4 und für ein \enquote{-{}-} 2. Sei
hierfür $w_{kj}$ die Wertung des Studierenden $k$ für das Projekt zu dem Team
$j$ gehört (für $j = M$ ist $w_{kj} := 0$).
\begin{align*}
\intertext{Zum Optimierungsterm:}
p_i \cdot \sum_{k=1}^{N}\sum_{j=1}^{M-1}w_{kj} \cdot B(k,j)
\end{align*}

\subsubsection{CriterionLearningGroup}
Das Kriterium sorgt dafür das Lerngruppen eher zusammenbleiben. Hierfür gibt es
für jedes Paar Studierender $p:= (a,b)$ mit $a,b \in \{ 1\ldots N\}: a > b$
einer Lerngruppe die zusammenbleiben einen Bonus $LgBonus_l$ von $\frac{10}{pair_l}$ wobei $pair_l$ die Anzahl der Paare der
Lerngruppe $l$ ist.
\begin{align*}
\intertext{Als Constraints: }
0 &\le y_{lpt} \le 1  \\
y_{lpt} &= B(a,t) \wedge B(b,t)
%y_{lpt} \le B(k_1,t) + B(k_2,t) -1, \; y_{lpt} \le B(k_2,t), \; y_{lpt} \le
%B(k_2,t) 
\end{align*}
$y_{lpt} =\begin{cases}
1 \;\; \text{wenn das Paar $p$ aus
Lerngruppe $l$ im  gleichen Team $t$ ist} \\
0 \;\;\text{sonst}
\end{cases}$
\begin{align*}
\intertext{Zum Optimierungsterm: } 
p_i \cdot LgBonus_l \cdot y_{lpt} \text{ für alle Paare, Lerngruppen und Teams}
\end{align*} 

\subsubsection{CriterionRegisteredAgain}
Das Kriterium sorgt dafür das Studierenden die sich schon einmal für einen PSE
Platz beworben haben bevorzugt werden. Hierfür wird dem Optimierungsterm
$p_i \cdot 10 \cdot \sum_{j = 1}^{M-1} B(k,j)$ hinzugefügt, wenn der
Studierende $k$ sich schon einmal um einen Platz beworben hat.
\subsubsection{CriterionPreferredTeamSize}
Das Kriterium sorgt dafür das Teams möglichst die gewünschte Teamgröße haben.
Das Team der nicht zugeteilten ist ausgeschlossen. Seien pro Team $j \in \{1\ldots M-1 \} \; c_j,o_j,z_j$ binäre Variablen.
Dabei sei: 
\begin{align*}
\intertext{Als Constraints: }
z_j &=x_j - preferredTeamSize\\
-maxSize_j \cdot (1-o_j) &\le z_j \le maxSize_j \cdot (1-o_j)\\
0.1\cdot(1-o_j) - (maxSize_j + 0.1)\cdot c_j &\le z_j \le -0.1\cdot
(1-o_j)+(maxSize_j +0.1)\cdot(1-c_j)\\
\intertext{Zum Optimierungsterm:} 
 &p_i \cdot 10 \cdot \sum_{j = 1}^{M-1}
o_j
\end{align*}
\subsubsection{CriterionSameSemester}
Das Kriterium sorgt dafür das Studierende des, für das PSE vorgesehenen
Semesters und Studierende höherer Semester eher nicht in das selbe Team kommen. 
Seien $a_{1t},a_{2t},a_{3t},a_{4t}$ Hilfsvariablen, bis auf $a_{1t}$ alle binär.
$drittSemester$ die Menge der Studierenden im für das PSE vorgesehenen Semester.
\begin{align*}
\intertext{Als Constraints:} 
a_{1t} &= \sum_{k \in drittSemester} B(k,t) \\
(1 - a_{2t}) &\le x_t - a_{1t} \\ (1 - a_{2t}) &\ge 0.1 \cdot x_t - a_{1t} \\
\intertext{$\text{Somit ist } a_{2t} = \begin{cases}
    1 \;\; \text{wenn $a_{1t} = x_t$} \\
    0 \;\; \text{sonst} 
\end{cases}$}
(1-a_{3t}) &\le a_{1t} \\
(1-a_{3t}) &\ge 0.1 \cdot a_{1t}\\
\intertext{$\text{Somit ist } a_{3t} = \begin{cases}
    1 \;\; \text{wenn $a_{1t} = 0$} \\
    0 \;\; \text{sonst} 
\end{cases}$}
a_{4t} &\le x_t \\
a_{4t} &\ge 0.1 \cdot x_t \\
\intertext{$\text{Somit ist } a_{4t} = \begin{cases}
    1 \;\; \text{wenn $x_t > 0$} \\
    0 \;\; \text{sonst} 
\end{cases}$}
e_t &= (a_{2t} \vee a_{3t}) \wedge a_{4t}\\
\intertext{Zum Optimierungsterm:} 
&p_i \cdot 10 \cdot \sum_{j=1 }^{M-1} e_j
\end{align*}
\subsubsection{CriterionPreferHigherSemester}
Das Kriterium sorgt dafür das Studierende höheren Semesters bevorzugt werden.
Hierfür wird dem Optimierungsterm $p_i \cdot 10 \cdot \sum_{j = 1}^{M-1} B(k,j)$ hinzugefügt, wenn der
Studierende $k$ in einem höheren Semester ist.
\subsubsection{CriterionAdditionalPerformances}
Das Kriterium sorgt dafür Studierende die mehr als die die zur Teilname am PSE
benötigten Teilleistungen bestanden haben bevorzugt werden. Hierfür wird dem Optimierungsterm
$p_i \cdot 10 \cdot \sum_{j = 1}^{M-1} B(k,j)$ hinzugefügt, wenn der Studierende
$k$ mehr als die zur Teilname am PSE benötigten Teilleistungen bestanden hat.
\subsubsection{CriterionNoSingularStudent}
Das Kriterium sorgt dafür das möglichst kein Team aus einer Lerngrupe sowie
einem einzelnen Studierenden besteht.
Sei $lg_i$ die Lerngruppengröße der $i$-ten Lerngruppe, es gebe $O$ Lerngruppen.
Weiterhin sei $\delta_j$ eine binäre Hilfsvariable.
\begin{align*}
\intertext{Als Constraints:} 
-9 \cdot a_{ji} &\le x_j -lg_i -1 \le 9\cdot a_{ji}\\
0.1 \cdot a_{ji} - 9.1 \cdot \delta_j &\le x_j -lg_i -1 \le -0.1 \cdot a_{ji} +
9.1 \cdot (1-\delta_j)\\
\intertext{$\text{Somit ist } a_{ji} = \begin{cases}
    0 \;\; \text{wenn $x_j = lg_i +1$} \\
    1 \;\; \text{sonst} 
\end{cases}$}
%a_{ji} \le x_j -lg_i -1 \\
%a_{ji} \ge 0.1 \cdot (x_j -lg_i-1)\\
\intertext{Zum Optimierungsterm: }
p_i \cdot 10 \cdot \sum_{j = 1}^{M-1} \sum_{i = 1}^{O}a_{ji}
\end{align*}

 \section{Anhang}
\subsection{Klassendiagramme}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/Class_Diagram.PNG}
\caption{Vollständiges Klassendiagramm}
\label{uml:classDiagram}
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/controller.png}
\caption{Controller}
\label{uml:controller}
\end{sidewaysfigure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{bilder/daten.png}
\caption{Datenmodell}
\label{uml:data}
\end{figure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/einteilung.png}
\caption{Einteilung}
\label{uml:allocation}
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/qualityCriteria.png}
\caption{Qualitätskriterien}
\label{uml:qualityCriteria}
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/security.png}
\caption{Sicherheit}
\label{uml:Sicherheit}
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/importExport.png}
\caption{Im- und Export}
\label{uml:imExport}
\end{sidewaysfigure}


\subsection{Sequenzdiagramme}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/seqAddAllocation.png}
\caption{Add Allocation}
\label{seq:addAlloction}
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\linewidth]{bilder/seqaddToQueue.png}
\caption{Add to Queue}
\label{seq:addToQueue}
\end{sidewaysfigure}
\end{document}